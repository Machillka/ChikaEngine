// Auto-generated by ChikaEngine Registry Generator. DO NOT EDIT.
#include "ChikaEngine/reflection/TypeRegister.h"
#include "{{ header_path }}"
#include <any>
#include "ChikaEngine/debug/log_macros.h"

namespace ChikaEngine::Reflection
{
    {% for class in classes %}
    // --- 反射实现: {{ class.full_name }} ---
    template<>
    class Reflector<{{ class.full_name }}>
    {
    public:
        static void Register()
        {
            ClassInfo info;
            info.Name = "{{ class.name }}";
            info.FullClassName = "{{ class.full_name }}";

            PropertyInfo prop;
            {% for field in class.fields %}
            // 字段: {{ field.name }}
            prop.Name = "{{ field.name }}";
            prop.Type = ReflectType::{{ field.reflect_type }};
            
            // Getter
            prop.Get = [](void* instance, void* outValue)
            {
                auto* obj = static_cast<{{ class.full_name }}*>(instance);
                *static_cast<{{ field.raw_type }}*>(outValue) = obj->{{ field.name }};
            };
            
            // Setter
            prop.Set = [](void* instance, const void* value)
            {
                auto* obj = static_cast<{{ class.full_name }}*>(instance);
                obj->{{ field.name }} = *static_cast<const {{ field.raw_type }}*>(value);
            };
            info.Properties.push_back(prop);
            {% endfor %}
        

            FunctionInfo func_info;
            {% for func in class.functions %}
            // 方法: {{ func.name }}
            func_info.Name = "{{ func.name }}";
            func_info.InvokeRaw = [](void* instance, const std::vector<std::any>& args)
            {
                auto* obj = static_cast<{{ class.full_name }}*>(instance);
                {% if func.params|length > 0 %}
                // 参数展开调用
                obj->{{ func.name }}(
                    {% for param in func.params %}
                    std::any_cast<{{ param.type }}>(args[{{ loop.index0 }}]){{ "," if not loop.last }}
                    {% endfor %}
                );
                {% else %}
                obj->{{ func.name }}();
                {% endif %}
            };
            info.Functions.push_back(func_info);
            {% endfor %}

            TypeRegister::Instance().RegisterClass(info);
        }
    };
    // 生成注册函数 提供给外部调用
//    static bool _reg_helper_Reflector_{{class.name}} = []() {
 //       Reflector<{{ class.full_name }}>::Register();
 //       LOG_INFO("Reflection", "Registered reflector for {{ class.full_name }}");
   //     return true;
   // }();
    {% endfor %}
} // namespace ChikaEngine::Reflection
extern "C" void {{ unique_id }}() {
    {% for class in classes %}
    ChikaEngine::Reflection::Reflector<{{ class.full_name }}>::Register();
    LOG_INFO("Reflection", "Linked reflection for {{ class.full_name }}");
    {% endfor %}
}